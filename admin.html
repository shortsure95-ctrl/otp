<!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin Panel</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root{--accent:#0b63d6;--muted:#6b7280}
*{box-sizing:border-box}
body{font-family:'Poppins',sans-serif;margin:0;background:linear-gradient(135deg,#2b5876,#4e4376);min-height:100vh;display:flex;align-items:center;justify-content:center;color:#fff;padding:20px}
.card{width:820px;max-width:100%;background:rgba(255,255,255,0.04);padding:22px;border-radius:12px}
label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#fff;margin-bottom:10px}
.btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;background:linear-gradient(135deg,#43e97b,#38f9d7);color:#012;font-weight:600}
.small{font-size:13px;color:var(--muted)}
.panel{background:rgba(255,255,255,0.03);padding:12px;border-radius:8px;margin-top:12px;max-height:260px;overflow:auto}
.hidden{display:none}
.row{display:flex;gap:8px}
</style>
</head>
<body>
  <div class="card">
    <h2>Admin Panel</h2>
    <p class="small">Admin login required. Default demo password = <strong>admin123</strong></p>

    <div id="loginBox">
      <label>Admin password</label>
      <input id="admin_pass" type="password">
      <div style="display:flex;justify-content:flex-end"><button id="adminLogin" class="btn">Enter Admin</button></div>
      <p id="adminMsg" class="small"></p>
    </div>

    <div id="adminArea" class="hidden">
      <h3>Create new user</h3>
      <label>Username</label>
      <input id="new_name">
      <label>Phone</label>
      <input id="new_phone" placeholder="+8801XXXXXXXXX">
      <label>Password</label>
      <input id="new_pass" type="password">
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="createUser" class="btn">Create user</button>
        <button id="refreshList" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff">Refresh</button>
      </div>
      <p id="createMsg" class="small"></p>

      <div class="panel" id="usersBox"></div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
        <div class="small">Note: This demo saves data in localStorage only.</div>
        <div style="display:flex;gap:8px">
          <button id="clearAll" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff">Clear all local data</button>
          <button id="backHome" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff">Back to User Page</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* Admin demo */
const lsGet = k => JSON.parse(localStorage.getItem(k));
const lsSet = (k,v) => localStorage.setItem(k, JSON.stringify(v));
const nowISO = ()=> new Date().toISOString();

// init admin & users
if(!localStorage.getItem('ms_admin')) {
  // demo admin record (plain password only for demo). CHANGE this in production.
  localStorage.setItem('ms_admin', JSON.stringify({ passPlain: 'admin123' }));
  alert('Demo admin created. Password = admin123 (change in code for production).');
}
if(!localStorage.getItem('ms_users')) lsSet('ms_users', []);

const adminLoginBtn = document.getElementById('adminLogin');
const adminPass = document.getElementById('admin_pass');
const adminMsg = document.getElementById('adminMsg');
const loginBox = document.getElementById('loginBox');
const adminArea = document.getElementById('adminArea');

const newName = document.getElementById('new_name');
const newPhone = document.getElementById('new_phone');
const newPass = document.getElementById('new_pass');
const createUserBtn = document.getElementById('createUser');
const createMsg = document.getElementById('createMsg');
const usersBox = document.getElementById('usersBox');

adminLoginBtn.addEventListener('click', ()=>{
  const attempt = adminPass.value;
  const admin = lsGet('ms_admin');
  if(attempt === admin.passPlain){
    loginBox.classList.add('hidden');
    adminArea.classList.remove('hidden');
    renderUsers();
  } else {
    adminMsg.textContent = 'Wrong admin password';
  }
});

createUserBtn.addEventListener('click', ()=>{
  createMsg.textContent='';
  const name = (newName.value||'').trim();
  const phone = (newPhone.value||'').trim();
  const pass = (newPass.value||'').trim();
  if(!name||!phone||!pass){ createMsg.textContent='সব ফিল্ড পূরণ করুন'; createMsg.style.color='crimson'; return; }
  let users = lsGet('ms_users')||[];
  if(users.find(u=>u.phone===phone)){ createMsg.textContent='এই ফোন নম্বর আগে থেকেই আছে'; createMsg.style.color='crimson'; return; }
  users.push({ username: name, phone, password: pass, subscriptionUntil: null, createdAt: nowISO(), createdByAdmin: true });
  lsSet('ms_users', users);
  createMsg.style.color='lightgreen'; createMsg.textContent='User created';
  newName.value=''; newPhone.value=''; newPass.value='';
  renderUsers();
});

function renderUsers(){
  const users = lsGet('ms_users')||[];
  if(users.length===0){ usersBox.innerHTML = '<div class="small">No users</div>'; return; }
  usersBox.innerHTML = users.map(u=>`<div style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.04)"><strong>${u.username}</strong> — ${u.phone} <div class="small" style="color:#cbd5e1;margin-top:6px">created: ${new Date(u.createdAt).toLocaleString()} • sub: ${u.subscriptionUntil? new Date(u.subscriptionUntil).toLocaleString() : 'none'}</div></div>`).join('');
}

document.getElementById('refreshList').addEventListener('click', renderUsers);
document.getElementById('backHome').addEventListener('click', ()=> window.location.href='index.html');

document.getElementById('clearAll').addEventListener('click', ()=>{
  if(!confirm('Delete ALL demo data from localStorage?')) return;
  localStorage.removeItem('ms_users');
  localStorage.removeItem('ms_admin');
  sessionStorage.removeItem('ms_session');
  alert('Cleared. Reload page.');
  location.reload();
});
</script>
</body>
</html>
